<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Карта задач Helpdesk</title>
<style>
  body { margin: 0; padding: 0; }
  #map { width: 100%; height: 100vh; }
</style>

<!-- Яндекс API с твоим ключом -->
<script src="https://api-maps.yandex.ru/2.1/?apikey=dc60a9c5-3268-40d8-9bf7-faa1168a1b70&lang=ru_RU" type="text/javascript"></script>

</head>
<body>

<div id="map"></div>

<script>
ymaps.ready(init);

async function init() {
    // Создаём карту с начальным центром (центр Москвы)
    const map = new ymaps.Map("map", {
        center: [55.76, 37.64],
        zoom: 10
    });

    // Загружаем твой JSON с задачами
    const tasks = await fetch("tasks.json").then(r => r.json());

    // Обходим каждую задачу
    for (let t of tasks) {
        if (!t.address) continue;

        try {
            // Геокодируем адрес
            const res = await ymaps.geocode(t.address);
            const first = res.geoObjects.get(0);

            if (!first) continue;

            const coords = first.geometry.getCoordinates();

            // Создаём метку
            const placemark = new ymaps.Placemark(coords, {
                balloonContentHeader: `ID: ${t.id}`,
                balloonContentBody: `Статус: ${t.status}<br>Адрес: ${t.address}`
            });

            map.geoObjects.add(placemark);
        } catch (e) {
            console.error("Ошибка геокодирования:", t.address, e);
        }
    }
}
</script>

</body>
</html>
