<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Карта задач Helpdesk</title>
<style>
  body { margin: 0; padding: 0; }
  #map { width: 100%; height: 100vh; }
</style>

<!-- Яндекс API с твоим ключом -->
<script src="https://api-maps.yandex.ru/2.1/?apikey=dc60a9c5-3268-40d8-9bf7-faa1168a1b70&lang=ru_RU" type="text/javascript"></script>

</head>
<body>

<div id="map"></div>

<script>
ymaps.ready(init);

async function init() {
    const map = new ymaps.Map("map", {
        center: [55.76, 37.64],
        zoom: 10
    });

    const tasks = await fetch("tasks.json").then(r => r.json());

    for (let t of tasks) {
        if (!t.address) continue;

        // геокодируем через Promise
        ymaps.geocode(t.address).then(function (res) {
            const firstGeoObject = res.geoObjects.get(0);
            if (!firstGeoObject) return;

            const coords = firstGeoObject.geometry.getCoordinates();

            const placemark = new ymaps.Placemark(coords, {
                balloonContentHeader: `ID: ${t.id}`,
                balloonContentBody: `Статус: ${t.status}<br>${t.address}`
            }, {
                preset: "islands#redDotIcon"
            });

            map.geoObjects.add(placemark);
        });
    }
}
</script>


</body>
</html>
